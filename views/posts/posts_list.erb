<%
  is_owner = locals[:is_owner] ||= false  
%>
<style>
.posts_list {
  margin-top: 20px;
}
.single_post_box {
  background-color: #f6f5f5;
  padding: 10px;
  position: relative;
  left: 10px;
  margin-bottom: 10px;
  list-style: none;
}
.single_post_box:hover {
  text-decoration: underline;
  /*border:1px solid lightgrey;*/
  cursor: pointer;
}
.posts_list li span {
  flex: 1;
}
.single_post_link {
  font-size: 18px;
  color: black;
}
.whether_post_open {
  position: absolute;
  color: lightgrey;
  top: 10px;
  left: 10px;
}
</style>
<div class='posts_list'>
  <ul>
  <% posts.each do |post| %>    
    <% 
      next unless post['title'].present? 
      post_id  = post[:_id]    
    
      post_title = escape_html(post['title'] || '(חסר כותרת)')
      num_mins   = get_post_mins(post)      
    %>
    <% user = $users.get(post[:user_id]) || {} %>
    <li class='single_post_box' onclick="document.location.href = $(this).find('a').attr('href')">
      
      <span><a class='single_post_link' href='/@<%=user['handle']%>/<%=post[:_id]%>'><%=post_title%></a> 
      <% if is_owner %>
      
      <div class='whether_post_open'>
        <div>
        <% if post[:post_open] == 'yes' %>
          <i class='fa fa-eye' style='color: #7adf78'></i>
        <% else %>
          <i class='fa fa-eye-slash'></i>
        <% end %>
        </div>

        <div class=bold>
          קריאות <%= get_post_num_views(post) %>
        </div>

        <div class=bold>
          <%
            last_view = nice_date($views.last(post_id: post_id)[:created_at])
          %>
          נקרא לאחרונה: <%= last_view %>
        </div>
      </div>

      <br/>
      
      
      <% end %>
      <div>
        <%= erb :'posts/post_metadata', locals: {owner: user, post: post} %>  
      </div>
      
      </span>
    
      <!-- <span class=''><%= nice_date(post['created_at']) %></span>
      <span class=''>כ-<%= num_mins %> דק׳ קריאה</span> -->
    </li>
  <% end %>
  </ul>
</div>
<!-- <p> האירועים שלי </p> -->      